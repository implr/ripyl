
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Ripyl VCD tutorial &#8212; Ripyl 1.2.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://kevinpt.github.io/opbasm/_static/project.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href='http://fonts.googleapis.com/css?family=Kreon:400,300,700' rel='stylesheet' type='text/css'>

   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ripyl-vcd-tutorial">
<h1>Ripyl VCD tutorial<a class="headerlink" href="#ripyl-vcd-tutorial" title="Permalink to this headline">Â¶</a></h1>
<p>This tutorial demonstrates how to generate Value Change Dump (VCD) files from a protocol simulation.</p>
<p>You can use the Ripyl simulation facilities to generate VCD test vectors with the <a class="reference internal" href="../apidoc/ripyl.io.html#module-ripyl.io.vcd" title="ripyl.io.vcd"><code class="xref py py-mod docutils literal"><span class="pre">ripyl.io.vcd</span></code></a> module. These files can be used to generate stimulus in applications such as pattern generators and HDL simulations.</p>
<p>The procedure for creating a VCD file is to first define a sequence of VCD channels, each containing the necessary data and a name. A VCDInfo object is then created which can be used to write a VCD file.</p>
<p>The VCD format uses integer time stamps with a resolution established by a timescale parameter. All edge transitions that occur within one timescale unit will be merged to the same time stamp. If the timescale is too large, entire edge transitions may be omitted if the state does not change between the start and end of a timescale unit. The timescale can either be explicitly set by passing a float to the VCDInfo constructor or it can be determined automatically with symbol rate analysis on a specified channel. Valid timescales must be powers of 10. In both cases the raw timescale parameter is coerced to a valid power of 10 less than or equal to the raw value (e.g. 3.0e-8 is coerced to 1.0e-8).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ripyl.io.vcd</span> <span class="kn">as</span> <span class="nn">vcd</span>
<span class="kn">import</span> <span class="nn">ripyl.protocol.spi</span> <span class="kn">as</span> <span class="nn">spi</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c"># Simulate some SPI communication</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">clk</span><span class="p">,</span> <span class="n">mosi</span><span class="p">,</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">spi</span><span class="o">.</span><span class="n">spi_synth</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">100e3</span><span class="p">)</span>

<span class="c"># Define the channels included in the VCD</span>
<span class="n">channels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">vcd</span><span class="o">.</span><span class="n">VCDChannel</span><span class="p">(</span><span class="s">&#39;clk&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">clk</span><span class="p">)),</span>
    <span class="n">vcd</span><span class="o">.</span><span class="n">VCDChannel</span><span class="p">(</span><span class="s">&#39;mosi&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">mosi</span><span class="p">)),</span>
    <span class="n">vcd</span><span class="o">.</span><span class="n">VCDChannel</span><span class="p">(</span><span class="s">&#39;cs&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">cs</span><span class="p">))</span>
<span class="p">]</span>

<span class="c"># Explicitly specify the timescale ...</span>
<span class="n">spi_vcd</span> <span class="o">=</span> <span class="n">vcd</span><span class="o">.</span><span class="n">VCDInfo</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&#39;SPI simulation&#39;</span><span class="p">)</span>

<span class="c"># ... or, alternatively, use the symbol rate of &#39;clk&#39; to set the timescale</span>
<span class="n">spi_vcd</span> <span class="o">=</span> <span class="n">vcd</span><span class="o">.</span><span class="n">VCDInfo</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="s">&#39;clk&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&#39;SPI simulation&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Timescale is:&#39;</span><span class="p">,</span> <span class="n">spi_vcd</span><span class="o">.</span><span class="n">timescale_si</span>

<span class="c"># Write the VCD file</span>
<span class="n">spi_vcd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;spi.vcd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces a VCD file <cite>spi.vcd</cite> that can be opened in a waveform viewer like GTKWave:</p>
<a class="reference internal image-reference" href="../_images/vcd_gtkwave.png"><img alt="../_images/vcd_gtkwave.png" src="../_images/vcd_gtkwave.png" style="width: 692.0px; height: 196.0px;" /></a>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/Ripyl_logo_100px.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Ripyl</a></h1>



<p class="blurb">Protocol decode and synthesis library</p>



<p>
<iframe src="https://ghbtns.com/github-btn.html?user=kevinpt&repo=ripyl&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div><h3>Other projects</h3>

<div id="proj_list">
<p>
<a href="http://kevinpt.github.io/opbasm/">Opbasm</a><br>

<a href="http://code.google.com/p/vertcl">Vertcl</a><br>
<a href="http://code.google.com/p/vhdl-extras">Vhdl-extras</a><br>
<a href="http://kevinpt.github.io/lecroy-colorizer/">Lecroy-colorizer</a>
</p>
</div>

<script>
$(function() { // Retrieve list of repositories from Github and dynamically insert them into sidebar

if(!window.sessionStorage || !JSON) { return; } // Punt on crusty browsers (looking at you IE10)

function JSONP( url, callback ) {
	var id = ( 'jsonp' + Math.random() * new Date() ).replace('.', '');
	var script = document.createElement('script');
	script.src = url.replace( 'callback=?', 'callback=' + id );
	document.body.appendChild( script );
	window[ id ] = function( data ) {
		if (callback) {
			callback( data );
		}
	};
}

function insert_projects(projects) {
    var links = [];
    var cur_proj = "Ripyl".toLowerCase();
    $.each(projects, function(key, value) {
      if(key != cur_proj) {
        var title = key.replace(/^./, function(match) {return match.toUpperCase()}); // Capitalize first char
        links.push("<a href='"+ value +"'>" + title + "</a>");
      }
    });
    
    $("#proj_list").html("<p>"+ links.join("<br>") +"</p>");
}

var now = new Date().getTime();
if(sessionStorage.KTcacheTime && now - sessionStorage.KTcacheTime < 5*60*1000 ) { // Use cached values (5 min. expiry)
  insert_projects(JSON.parse(sessionStorage.KTprojects));
} else { // Retrieve current projects
  JSONP("https://api.github.com/users/kevinpt/repos?type=owner&callback=?", function(response) {
    var projects = {};
    $.each(response.data, function(index, value) {
      projects[value.name] = value.homepage;
    });
    
    insert_projects(projects);
    
    // Store data in session cache
    sessionStorage.KTprojects = JSON.stringify(projects);
    var now = new Date().getTime();
    sessionStorage.KTcacheTime = now;
  });  
}

});
</script>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2015, Kevin Thibedeau.
      
      |
      <a href="../_sources/rst/tut_vcd.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43149311-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>